<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vozmia | FAQ Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="/css/styles.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  
  <link href="https://fonts.googleapis.com/css2?family=Kdam+Thmor+Pro&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">
  
  <%- include('partials/header') %>

  <main class="flex w-full justify-center py-13">
    
    <div class="flex flex-col gap-4 max-w-250 bg-white">
      <div class="rounded-lg border bg-card text-card-foreground shadow-sm" data-v0-t="card">
        <div class="flex flex-col space-y-1.5 p-6">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-2xl font-semibold leading-none tracking-tight">FAQ Management</h3>
              <p class="text-sm text-muted-foreground">Review, answer, or ignore customer questions</p>
            </div>
            <!-- <div class="flex items-center gap-2">
              <div class="relative">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.3-4.3"></path>
                </svg>
                <input class="flex h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 w-[200px] sm:w-[300px] pl-8" placeholder="Search questions..." type="search">
              </div>
              <button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 w-10">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-filter h-4 w-4">
                  <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
              </button>
            </div> -->
          </div>
        </div>
        <div class="p-6 pt-0">
          <div dir="ltr" data-orientation="horizontal" class="w-full">
            <!-- <div role="tablist" aria-orientation="horizontal" class="bg-gray-200 h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground grid w-full grid-cols-2 mb-4" tabindex="0" data-orientation="horizontal" style="outline: currentcolor;">
              <button type="button" role="tab" aria-selected="true"  data-state="active"  class="bg-white inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">Pending <div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80 ml-2" data-v0-t="badge">4</div>
              </button>
              <button type="button" role="tab" aria-selected="false" data-state="inactive"  class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">Answered <div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80 ml-2" data-v0-t="badge">2</div>
              </button>
            </div> -->
            <div data-state="active" data-orientation="horizontal" role="tabpanel" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" style="animation-duration: 0s;">
              
                
                
              <% selectedBusiness.faqs.forEach(faq => { 
                const now = new Date();
                const created = new Date(faq.createdAt);
                const diffMs = now - created;
                const hoursAgo = Math.floor(diffMs / (1000 * 60 * 60));
              %>
                <div class="border rounded-lg p-4 mb-3" id="faqCard-<%= faq._id %>">
                  <div class="flex items-start justify-between">
                    <div class="space-y-1">
                      <h3 class="font-medium"><%= faq.question.charAt(0).toUpperCase() + faq.question.slice(1) %></h3>
                      <p class="text-sm text-muted-foreground">
                        From: <%= faq.email || 'Guest' %> • 
                        <%= hoursAgo < 1 ? 'Just now' : hoursAgo === 1 ? '1 hour ago' : `${hoursAgo} hours ago` %>
                      </p>
                      <% if (faq.reply) { %>
                        <div class="bg-gray-100 text-sm text-gray-700 p-3 rounded mt-2">
                          <strong>✅ Answer:</strong> <%= faq.reply %>
                          <p class="text-xs text-gray-400 mt-1">Replied at: <%= new Date(faq.repliedAt).toLocaleDateString() %></p>
                        </div>
                      <% } %>
                    </div>
                    <div class="flex gap-2">
                        <% if (!faq.reply) { %>
                          <button 
                            data-ignore="<%= faq._id %>" 
                            class="ignore-btn inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground rounded-md px-3 h-8">
                            <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-circle-x h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <circle cx="12" cy="12" r="10"></circle>
                              <path d="m15 9-6 6"></path>
                              <path d="m9 9 6 6"></path>
                            </svg>
                            Ignore
                          </button>
                        <% } %>

                        <button 
                          data-reply="<%= faq._id %>" 
                          class="reply-btn bg-black text-white inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary hover:bg-primary/90 rounded-md px-3 h-8">
                          <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-circle-check-big h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <path d="m9 11 3 3L22 4"></path>
                          </svg>
                          <%= faq.reply ? 'Edit Reply' : 'Respond' %>
                        </button>
                      </div>
                  </div>
              
                  <div class="mt-4 hidden reply-input-wrapper" id="replyInput-<%= faq._id %>">
                    <form action="/api/businesses/<%= selectedBusiness._id %>/faqs/<%= faq._id %>/reply" method="POST">
                      <textarea name="reply" placeholder="Type your reply..." class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500" required><%= faq.reply || '' %></textarea>
                      <button type="submit" class="mt-2 bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded text-sm">
                        <%= faq.reply ? 'Update Reply' : 'Send Reply' %>
                      </button>
                    </form>
                  </div>
                </div>
              <% }) %>
            
              </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </main>

  <%- include('partials/footer') %>


  <script type="module" src="/js/dashboardFaq.js"></script>
  <script type="module" src="/js/dropdown.js"></script>

</body>
</html>