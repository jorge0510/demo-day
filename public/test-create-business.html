<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Your Business</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">

  <!-- Open Modal Button -->
  <button
    id="openModalBtn"
    class="px-6 py-3 bg-blue-600 text-white font-medium rounded hover:bg-blue-700"
  >
    Add Your Business
  </button>

  <!-- Modal Background -->
  <div id="modalBackdrop" class="hidden fixed inset-0 bg-black/40 z-40"></div>

  <!-- Modal -->
  <div id="businessModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg w-full max-w-2xl shadow-lg p-6 relative">

      <!-- Close Button -->
      <button id="closeModalBtn" class="absolute top-4 right-4 text-gray-500 hover:text-black text-xl">&times;</button>

      <!-- Title -->
      <h2 class="text-xl font-semibold mb-1">Add Your Business</h2>
      <p class="text-gray-500 text-sm mb-4">Get your business listed in our directory to reach more customers.</p>

      <!-- Step Tabs -->
      <div class="flex mb-4 border-b">
        <button class="step-tab px-4 py-2 text-sm font-medium border-b-2" data-step="0">Business Info</button>
        <button class="step-tab px-4 py-2 text-sm font-medium text-gray-500" data-step="1">Details</button>
        <button class="step-tab px-4 py-2 text-sm font-medium text-gray-500" data-step="2">Contact</button>
      </div>

      <!-- Step Content -->
      <form id="businessForm" class="space-y-4" enctype="multipart/form-data">
        <!-- Step 1 -->
        <div class="step-content" data-step="0">
          <label class="block font-medium">Business Name</label>
          <input type="text" name="name" class="w-full border rounded px-3 py-2" required>

          <label class="block font-medium mb-1">Category</label>
          <select name="category" required class="shadow-none bg-white border-gray-200 w-full rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 shadow-sm focus:border-black focus:outline-none focus:ring-1 focus:ring-black">
            <option value="" disabled selected>Select a category</option>
            <option value="Restaurants">Restaurants</option>
            <option value="Technology">Technology</option>
            <option value="Healthcare">Healthcare</option>
            <option value="Fitness">Fitness</option>
            <option value="Professional Services">Professional Services</option>
            <option value="Retail">Retail</option>
            <option value="Automotive">Automotive</option>
          </select>

          <label class="block font-medium">Address</label>
          <input type="text" name="address" class="w-full border rounded px-3 py-2" required>

          <div class="flex gap-4">
            <div class="w-1/2">
              <label class="block font-medium">City</label>
              <input type="text" name="city" class="w-full border rounded px-3 py-2">
            </div>
            <div class="w-1/2">
              <label class="block font-medium">State</label>
              <input type="text" name="state" class="w-full border rounded px-3 py-2">
            </div>
            <div class="w-1/2">
              <label class="block font-medium">ZIP Code</label>
              <input type="text" name="zipCode" class="w-full border rounded px-3 py-2">
            </div>
          </div>

          <label class="block font-medium">Description</label>
          <textarea name="description" class="w-full border rounded px-3 py-2"></textarea>
        </div>

        <!-- Step 2 -->
        <div class="step-content hidden" data-step="1">
          <label class="block font-medium mb-2">Business Hours</label>
          <div class="grid grid-cols-2 gap-2">
            <input name="hours.Monday" placeholder="Monday" class="border rounded px-3 py-2" />
            <input name="hours.Tuesday" placeholder="Tuesday" class="border rounded px-3 py-2" />
            <input name="hours.Wednesday" placeholder="Wednesday" class="border rounded px-3 py-2" />
            <input name="hours.Thursday" placeholder="Thursday" class="border rounded px-3 py-2" />
            <input name="hours.Friday" placeholder="Friday" class="border rounded px-3 py-2" />
            <input name="hours.Saturday" placeholder="Saturday" class="border rounded px-3 py-2" />
            <input name="hours.Sunday" placeholder="Sunday" class="border rounded px-3 py-2" />
          </div>

          <label class="block font-medium mt-4 mb-2">Amenities</label>
          <div class="grid grid-cols-2 gap-2">
            <label><input type="checkbox" name="amenities" value="Free WiFi" /> Free WiFi</label>
            <label><input type="checkbox" name="amenities" value="Parking" /> Parking</label>
            <label><input type="checkbox" name="amenities" value="Delivery" /> Delivery</label>
            <label><input type="checkbox" name="amenities" value="Takeout" /> Takeout</label>
            <label><input type="checkbox" name="amenities" value="Wheelchair Accessible" /> Wheelchair Accessible</label>
            <label><input type="checkbox" name="amenities" value="Outdoor Seating" /> Outdoor Seating</label>
          </div>

          <label class="block font-medium mt-4">Business Photo</label>
          <input type="file" name="image" accept="image/*" class="w-full border rounded px-3 py-2" />
        </div>

        <!-- Step 3 -->
        <div class="step-content hidden" data-step="2">
          <label class="block font-medium">Phone</label>
          <input type="text" name="phone" class="w-full border rounded px-3 py-2" />

          <label class="block font-medium">Email</label>
          <input type="email" name="email" class="w-full border rounded px-3 py-2" />

          <label class="block font-medium">Website</label>
          <input type="text" name="website" class="w-full border rounded px-3 py-2" />

          <label class="block font-medium">Facebook</label>
          <input type="text" name="social.facebook" class="w-full border rounded px-3 py-2" />

          <label class="block font-medium">Instagram</label>
          <input type="text" name="social.instagram" class="w-full border rounded px-3 py-2" />
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between mt-6">
          <button type="button" id="prevBtn" class="px-4 py-2 bg-gray-200 rounded text-sm hidden">Previous</button>
          <button type="button" id="nextBtn" class="px-4 py-2 bg-black text-white rounded text-sm">Next</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const modal = document.getElementById('businessModal');
    const backdrop = document.getElementById('modalBackdrop');
    const openBtn = document.getElementById('openModalBtn');
    const closeBtn = document.getElementById('closeModalBtn');
    const tabs = document.querySelectorAll('.step-tab');
    const steps = document.querySelectorAll('.step-content');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    let currentStep = 0;

    function showStep(index) {
      steps.forEach((step, i) => step.classList.toggle('hidden', i !== index));
      tabs.forEach((tab, i) => {
        tab.classList.toggle('text-gray-500', i !== index);
        tab.classList.toggle('border-b-2', i === index);
      });
      prevBtn.classList.toggle('hidden', index === 0);
      nextBtn.textContent = index === steps.length - 1 ? 'Submit Business' : 'Next';
    }

    openBtn.onclick = () => {
      modal.classList.remove('hidden');
      backdrop.classList.remove('hidden');
      currentStep = 0;
      showStep(currentStep);
    };

    closeBtn.onclick = () => {
      modal.classList.add('hidden');
      backdrop.classList.add('hidden');
    };

    tabs.forEach(tab => {
      tab.onclick = () => {
        currentStep = parseInt(tab.dataset.step);
        showStep(currentStep);
      };
    });

    nextBtn.onclick = () => {
      if (currentStep === steps.length - 1) {
        const form = document.getElementById('businessForm');
        const formData = new FormData(form);

        fetch('http://localhost:3000/api/businesses', {
          method: 'POST',
          body: formData // Let the browser set Content-Type with boundary
        }).then(async res => {
          const result = await res.json();
          if (res.ok) {
            alert('Business submitted!');
            modal.classList.add('hidden');
            backdrop.classList.add('hidden');
            form.reset();
          } else {
            alert('Error: ' + result.error);
          }
        }).catch(err => {
          alert('Network error');
          console.error(err);
        });
      } else {
        currentStep++;
        showStep(currentStep);
      }
    };

    prevBtn.onclick = () => {
      if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
      }
    };
  </script>

</body>
</html>
